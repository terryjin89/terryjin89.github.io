---
layout: single
title:  "JSP - MVC2 model"
category: tool
tag: [JAVA, JSP, MVC]
---

## Define - Web application architecture that implements MVC patterns using Servlet and JSP
#### 서블릿과 JSP를 사용하여 MVC 패턴을 구현하는 웹 애플리케이션 아키텍쳐
#### Conceptual Diagram
![ConcepDiagram](/images/tool/JSP_MVC2_conceptual_diagram.png "ConcepDiagram")
#### Example - dept
![ExDiagram](/images/tool/JSP_MVC2_ex_dept.png "ExDiagram")


## Component
### 1.Controller - Servlet, Front Controller
##### Entry point that accepts and processes all requests from the client
##### EX) DeptFrontController.java
```JAVA
//DeptForentController.java
package embed.controller;

import java.io.IOException;

import embed.service.DeptListServiceImpl;
import embed.service.DeptService;
import embed.service.DeptWriteServiceImpl;
import jakarta.servlet.RequestDispatcher;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

// This servlet acts as a Front Controller for all requests ending in .do
@WebServlet("*.do")
public class DeptFrontController extends HttpServlet {

	// Handles HTTP GET requests by delegating them to the doPost method.
	@Override
	protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		// Forward GET requests to the doPost method for centralized processing.
		doPost(req, resp);
	}
	
	// Handles HTTP POST requests and routes them to the appropriate service.
	@Override
	protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		// Extract the command from the request URI.
		String requestURI = req.getRequestURI(); // The full URI of the request.
		String contextPath = req.getContextPath(); // The context path of the application.
		String command = requestURI.substring(contextPath.length()); // The specific command to execute (e.g., /list.do).
		
		DeptService service = null; // The service to be executed.
		String nextPage = null; // The path to the next page to be displayed.
		
		// Route the request based on the command.
		if(command.equals("/list.do")) {
			// If the command is to list departments.
			service = new DeptListServiceImpl(); // Create an instance of the list service.
			service.execute(req, resp); // Execute the service to fetch the department list.
			nextPage = "list.jsp"; // Set the next page to the list view.
		}
		
		if(command.equals("/writeui.do")) {
			// If the command is to show the write form.
			nextPage = "Write.jsp";	// Set the next page to the write form.		
		}
		
		if(command.equals("/write.do")) {
			// If the command is to write a new department.
			service = new DeptWriteServiceImpl(); // Create an instance of the write service.
			service.execute(req, resp); // Execute the service to save the new department.
			nextPage = "list.do"; // Redirect to the list command to show the updated list.
		}
		
		// Forward the request to the next page.
		RequestDispatcher dis = req.getRequestDispatcher(nextPage);
		dis.forward(req, resp);
	}
	
}
```

### 2.Model - Service / DAO / DTO
##### (1) Service - Responsible for Business Logic
##### EX) DeptService.java, DeptListServiceImpl.java, DeptWriteServiceImpl.java
```JAVA
//DeptService.java
package embed.service;

import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

// This interface defines the contract for all service implementations.
public interface DeptService {
	// The execute method will be implemented by concrete service classes to handle specific business logic.
	public void execute(HttpServletRequest request, HttpServletResponse response);
}
```
```JAVA
//DeptListServiceImpl.java
package embed.service;

import java.util.ArrayList;

import embed.dao.DeptDAO;
import embed.entity.DeptDTO;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

// This service implementation handles the logic for listing all departments.
public class DeptListServiceImpl implements DeptService {

	// Executes the business logic to retrieve the list of departments.
	@Override
	public void execute(HttpServletRequest request, HttpServletResponse response) {
		// Create a new instance of the Data Access Object.
		DeptDAO dao = new DeptDAO();
		// Call the DAO to get the list of all departments from the database.
		ArrayList<DeptDTO> list = dao.list();
		// Set the retrieved list as an attribute in the request object to be passed to the view (JSP).
		request.setAttribute("list", list);
	}
	
}
```
```JAVA
//DeptWriteServiceImpl.java
package embed.service;

import embed.dao.DeptDAO;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

// This service implementation handles the logic for adding a new department.
public class DeptWriteServiceImpl implements DeptService{
	// Executes the business logic to create a new department record.
	@Override
	public void execute(HttpServletRequest request, HttpServletResponse response) {
		// Retrieve department data from the incoming HTTP request.
		String deptno = request.getParameter("deptno"); // Department number.
		String dname = request.getParameter("dname");   // Department name.
		String loc = request.getParameter("loc");       // Location.
		
		// Create a new instance of the Data Access Object.
		DeptDAO dao = new DeptDAO();
		// Call the DAO to insert the new department data into the database.
		dao.write(deptno, dname, loc);
	}
}
```
##### (2) DTO - Data delivery object (class containing DB results) / EX) DeptDTO.java
```JAVA
//DeptDTO.java
package embed.entity;

// Data Transfer Object (DTO) for department data.
// This class is used to encapsulate department data and transfer it between different layers of the application.
public class DeptDTO {
	private int deptno;      // Department number
	private String dname;    // Department name
	private String loc;      // Location

	// Default constructor.
	public DeptDTO() {
	}
	
	// Constructor to initialize a DeptDTO object with data.
	public DeptDTO(int deptno, String dname, String loc) {
		this.deptno = deptno;
		this.dname = dname;
		this.loc = loc;
	}
	
	// Getter for department number.
	public int getDeptno() {
		return deptno;
	}
	// Setter for department number.
	public void setDeptno(int deptno) {
		this.deptno = deptno;
	}
	// Getter for department name.
	public String getDname() {
		return dname;
	}
	// Setter for department name.
	public void setDname(String dname) {
		this.dname = dname;
	}
	// Getter for location.
	public String getLoc() {
		return loc;
	}
	// Setter for location.
	public void setLoc(String loc) {
		this.loc = loc;
	}
}
```
##### (3) DAO - DB access,(run SQL) / EX) DeptDAO.java
```JAVA
//DeptDAO.java
package embed.dao;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;

import embed.entity.DeptDTO;

// Data Access Object (DAO) for database operations related to departments.
public class DeptDAO {
	// Database connection details.
	String driver = "com.mysql.cj.jdbc.Driver";
	String url = "jdbc:mysql://localhost:3306/embed";
	String user = "root";
	String pwd = "1111";
	
	// Constructor: Loads the JDBC driver when a DAO instance is created.
	public DeptDAO() {
		try {
			Class.forName(driver);
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
	
	// Retrieves a list of all departments from the database.
	public ArrayList<DeptDTO> list() {
		ArrayList<DeptDTO> list = new ArrayList<DeptDTO>();
		Connection con = null;
		PreparedStatement pstmt = null;
		ResultSet rs = null;
		
		try {
			// Establish a connection to the database.
			con = DriverManager.getConnection(url, user, pwd);
			// SQL query to select all departments.
			String query = "SELECT * FROM dept";
			pstmt = con.prepareStatement(query);
			// Execute the query.
			rs = pstmt.executeQuery();
			
			// Iterate through the result set.
			while(rs.next()) {
				int deptno = rs.getInt("deptno");
				String dname = rs.getString("dname");
				String loc = rs.getString("loc");
				
				// Create a DTO for each department and add it to the list.
				DeptDTO data = new DeptDTO(deptno, dname, loc);
				list.add(data);
			}
		} catch (Exception e) {
			e.printStackTrace();
		} finally {
			// Close all resources to prevent memory leaks.
			try {
				if(rs != null) { rs.close(); }
				if(pstmt != null) { pstmt.close(); }
				if(con != null) { con.close(); }
			} catch (Exception e2) {
				e2.printStackTrace();
			}
		}
		
		return list;
	}
	
	// Inserts a new department into the database.
	public void write(String _deptno, String _dname, String _loc) {
		
		Connection con = null;
		PreparedStatement pstmt = null;
		
		try {
			// Establish a connection to the database.
			con = DriverManager.getConnection(url, user, pwd);
			// SQL query to insert a new department.
			String query = "INSERT INTO dept(deptno, dname, loc) VALUES(?,?,?);";
			pstmt = con.prepareStatement(query);
			// Set the parameters for the prepared statement.
			pstmt.setInt(1, Integer.parseInt(_deptno));
			pstmt.setString(2, _dname);
			pstmt.setString(3, _loc);
			
			// Execute the update.
			pstmt.executeUpdate();
		} catch (Exception e) {
			e.printStackTrace();
		} finally {
			// Close all resources.
			try {
				if(pstmt != null) { pstmt.close(); }
				if(con != null) { con.close(); }
			} catch (Exception e2) {
				e2.printStackTrace();
			}
			
		}
	}
}
```
### 3.View - JSP
##### A screen (UI) that outputs data passed by the controller
##### EX) list.jsp, write.jsp

```html
<!--list.jsp-->
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>DEPT Table View</title>
<style>
	/* Basic styling for the container and table */
	#container {
		width: 600px;
		height: 400px;
		margin: 10px auto;
	}
	table td {
		border: 1px solid #cdcdcd;
		border-collapse: collapse;
	}
</style>
</head>
<body>
	<h1>Department List</h1>
	<div id="container">
		<table>
			<!-- Table Header -->
			<tr>
				<td>Dept No</td>
				<td>Dept Name</td>
				<td>Location</td>
			</tr>
			<!-- Iterate over the list of departments passed from the servlet -->
			<c:forEach var="dept" items="${list}" step="1">
				<tr>
					<!-- Display department details -->
					<td>${dept.deptno}</td>
					<td>${dept.dname}</td>
					<td>${dept.loc}</td>
				</tr>
			</c:forEach>
		</table>
	</div>
</body>
</html>
```
```HTML
<!--write.jsp-->
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Department Entry Form</title>
</head>
<body>
	<h2>New Department Form</h2>
	<!-- This form submits data to the 'write.do' action using the POST method -->
	<form action="write.do" method="post"><br>
		Department Number: <input type="text" name="deptno"><br>
		Department Name: <input type="text" name="dname"><br>
		Location: <input type="text" name="loc"><br>
		<input type="submit" value="Save">
	</form>
	
</body>
</html>
```
### 4.